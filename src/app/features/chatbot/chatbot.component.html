<!-- ðŸ’¬ Floating Button -->
<button type="button" (click)="toggleChat()" class="chat-fab" aria-label="Open chat">
  <svg viewBox="0 0 24 24" aria-hidden="true">
    <path
      fill="currentColor"
      d="M12 3C7.03 3 3 6.58 3 11c0 1.61.61 3.09 1.64 4.33L3 21l6.14-1.7c.93.26 1.91.4 2.86.4 4.97 0 9-3.58 9-8s-4.03-9-9-9z"
    />
  </svg>
</button>

<!-- ðŸªŸ Chat Popup -->
<div *ngIf="showChat()" class="chat-panel animate-fade-in" aria-live="polite">
  <div class="chat-header">
    <div class="chat-title">
      <div class="chat-avatar">
        <div class="chat-avatar-inner">WY</div>
      </div>
      <div>
        <div class="chat-name">Yumna Assistant</div>
        <div class="chat-status">online</div>
      </div>
    </div>
    <button type="button" (click)="toggleChat()" class="chat-close" aria-label="Close chat">&times;</button>
  </div>

  <div #chatMessages class="chat-body">
    <ng-container *ngFor="let msg of conversation(); let last = last">
      <div class="chat-row chat-row-user">
        <div class="bubble bubble-user">
          {{ msg.user }}
        </div>
      </div>

      <div class="chat-row chat-row-bot">
        <div class="bubble bubble-bot">
          <ng-container *ngIf="last && isTyping(); else finalText">
            {{ typingBuffer() }}<span class="typing-caret">â–ˆ</span>
          </ng-container>
          <ng-template #finalText>{{ msg.bot }}</ng-template>
        </div>
      </div>
    </ng-container>
  </div>

  <form (submit)="send()" class="chat-input">
    <input
      [(ngModel)]="input"
      name="input"
      class="chat-input-field"
      placeholder="Message..."
      autocomplete="off"
    />
    <button type="submit" class="chat-send" aria-label="Send message">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path
          fill="currentColor"
          d="M2.3 12.7l18.7-8.2c.7-.3 1.4.4 1.1 1.1l-8.2 18.7c-.3.7-1.3.6-1.5-.1l-2.1-7.2-7.2-2.1c-.7-.2-.8-1.2-.1-1.5zM10.4 13.6l2 6.7 5.8-13.2-13.2 5.8 4.7 1.4c.3.1.5.3.7.5z"
        />
      </svg>
    </button>
  </form>
</div>
